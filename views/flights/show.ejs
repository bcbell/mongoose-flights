<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville&display=swap" rel="stylesheet">
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <title>Ticketing</title>
</head>
<body class="flightsIndex">

    <header>
       <h1><%= title  %> </h1>
        <nav>
          <a href="/">Home</a>
          <a href="/flights">Flight Log </a>
          <a href="/flights/new">Flight Search</a>
        </nav>
      </header> 

      <p class="flightDetails">Please review & confirm the flight details below</p>
      
      <section>
      <table class="flightTable" >
        <tr class="flightTableHeading">
        
            <th>Airline</th>
            <th>Departure Airport</th>
            <th>Arrival Airport</th>
            <th>Flight Departure Number</th>
            <th>Flight Arrival Number </th>
            <th>Departure Date & Time</th>
            <th>Return Date & Time</th>
        </tr>
        <tr>
          <td><%= flights.airline  %> </td>
          <td><%= flights.airport  %> </td>
          <td><%= flights.arrivalAirport %> </td>
          <td><%= flights.flightNo  %> </td>
          <td><%= flights.arrivalFlightNo  %> </td>
          <td><%= flights.departs  %> </td>
          <td><%= flights.returns  %> </td>
        </tr>
        </table>
      </section>
      <br>
      <br>
      <section class="bookTicket">
        <form class="ticketingInfo" method="POST" action="/flights/<%=flights._id%>/tickets"> 
          <p class="bookFlight">Book a flight</p>
          <label for="cabinClass">Best Cabin Fares</label>
          <select name="cabinClass" class="cabinClass">
            <optgroup label="Cabin Fares">
              <option value="Economy">Basic Economy</option>
              <option value="Premium Economy">Premium Economy</option>
              <option value="Business">Business</option>
              <option value="First Class">First Class</option>
            </optgroup>
          </select>
          <br>
          Seat Selection:<input name="seat" required pattern="[A-F][1-9]\d?" placeholder="A10">
          <br>
          Price: $<input class="price" name="price" type="number" min="0">
          <br> 
          <input class="bookFlight" type="submit" value="Book Flight">
        </form>
      </section> 
        <br>
        <br>
      <section class="tickets">
        <% if (flights.tickets.length){ %> 
      <table>
        <thead class="tickets">
          <tr>
            <th colspan="3">Ticketing Details</th>
          </tr>
          <tr>
            <th>Cabin </th>
            <th>Ticket Seat</th>
            <th>Ticket Price</th>  
          </tr>
        </thead>
        <tbody>
          <% let total = 0 %> 
          <% flights.tickets.forEach(function(t){  %> 
            <% total += t.price %> 
         <tr>
          <td class="cabinClass"><%= t.cabinClass %> </td>
          <td class="seat"><%= t.seat%> </td>
          <td class="price">$<%= t.price %> </td>
        </tr>
      <% }); %>
      <tr>
        <td colspan="2">Total</td>
        <td><strong>$<%=(total / flights.tickets.length.toFixed(1))%></strong></td>
      </tr> 
    </tbody>
</table>
<% }else{ %> 
  <strong><h5 class="noTicket"> No tickets have been requested for this flight</h5></strong>
<% } %> 
</section>
</body>
</html>